import tkinter as tk
from tkinter import ttk, messagebox
import sqlite3
import re

DB_NAME = "post_office.db"

PARCEL_TYPES = ["–ü–∏—Å—å–º–æ", "–ë–∞–Ω–¥–µ—Ä–æ–ª—å", "–ü–æ—Å—ã–ª–∫–∞", "–û–¥–µ–∂–¥–∞", "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞", "–ü–æ—Å—É–¥–∞"]
PARCEL_STATUS = ["–ü—Ä–∏–Ω—è—Ç–æ", "–í –ø—É—Ç–∏", "–í –æ—Ç–¥–µ–ª–µ–Ω–∏–∏", "–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ", "–í–æ–∑–≤—Ä–∞—Ç"]
PAYMENT_METHODS = ["–ù–∞–ª–∏—á–Ω—ã–µ", "–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞", "–°–ë–ü"]


def db_connect():
    return sqlite3.connect(DB_NAME)


def get_column_values(table, column):
    conn = db_connect()
    cur = conn.cursor()
    cur.execute(f"SELECT {column} FROM {table}")
    values = [str(v[0]) for v in cur.fetchall()]
    conn.close()
    return values


class BasePage(tk.Frame):
    def __init__(self, parent):
        super().__init__(parent, bg="#000")

    def create_tree(self, columns, headings):
        frame = tk.Frame(self, bg="#000")
        frame.pack(fill="both", expand=True, padx=20, pady=10)

        tree = ttk.Treeview(frame, columns=columns, show="headings", height=14)
        vsb = ttk.Scrollbar(frame, orient="vertical", command=tree.yview)
        tree.configure(yscrollcommand=vsb.set)

        tree.grid(row=0, column=0, sticky="nsew")
        vsb.grid(row=0, column=1, sticky="ns")

        frame.rowconfigure(0, weight=1)
        frame.columnconfigure(0, weight=1)

        for col, head, w in headings:
            tree.heading(col, text=head)
            tree.column(col, width=w, anchor="center")

        return tree


class ClientPage(BasePage):
    def __init__(self, parent):
        super().__init__(parent)
        self.selected_id = None
        self.build_ui()
        self.load_data()

    def build_ui(self):
        cols = ("id", "fio", "tel", "addr")
        heads = [
            ("id", "ID", 60),
            ("fio", "–§–ò–û", 220),
            ("tel", "–¢–µ–ª–µ—Ñ–æ–Ω", 120),
            ("addr", "–ê–¥—Ä–µ—Å", 260),
        ]
        self.tree = self.create_tree(cols, heads)
        self.tree.bind("<<TreeviewSelect>>", self.on_select)

        form = tk.Frame(self, bg="#000")
        form.pack(fill="x", padx=20, pady=5)

        self.fio_var = tk.StringVar()
        self.tel_var = tk.StringVar()
        self.adr_var = tk.StringVar()

        tk.Label(form, text="–§–ò–û", fg="white", bg="#000").grid(row=0, column=0, sticky="w")
        tk.Entry(form, textvariable=self.fio_var).grid(row=0, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–¢–µ–ª–µ—Ñ–æ–Ω", fg="white", bg="#000").grid(row=1, column=0, sticky="w")
        tk.Entry(form, textvariable=self.tel_var).grid(row=1, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–ê–¥—Ä–µ—Å", fg="white", bg="#000").grid(row=2, column=0, sticky="w")
        tk.Entry(form, textvariable=self.adr_var).grid(row=2, column=1, sticky="ew", padx=5, pady=2)

        form.columnconfigure(1, weight=1)

        btns = tk.Frame(self, bg="#000")
        btns.pack(fill="x", padx=20, pady=5)

        tk.Button(btns, text="–î–æ–±–∞–≤–∏—Ç—å", command=self.add).pack(side="left", padx=5)
        tk.Button(btns, text="–û–±–Ω–æ–≤–∏—Ç—å", command=self.update).pack(side="left", padx=5)
        tk.Button(btns, text="–£–¥–∞–ª–∏—Ç—å", command=self.delete).pack(side="left", padx=5)
        tk.Button(btns, text="–û—á–∏—Å—Ç–∏—Ç—å", command=self.clear_form).pack(side="left", padx=5)

    def load_data(self):
        for r in self.tree.get_children():
            self.tree.delete(r)
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("SELECT ID_–ö–ª–∏–µ–Ω—Ç–∞, –§–ò–û, –¢–µ–ª–µ—Ñ–æ–Ω, –ê–¥—Ä–µ—Å FROM –ö–ª–∏–µ–Ω—Ç")
        for row in cur.fetchall():
            self.tree.insert("", "end", values=row)
        conn.close()

    def on_select(self, _):
        sel = self.tree.selection()
        if not sel:
            return
        vals = self.tree.item(sel[0], "values")
        self.selected_id = int(vals[0])
        self.fio_var.set(vals[1])
        self.tel_var.set(vals[2])
        self.adr_var.set(vals[3])

    def clear_form(self):
        self.selected_id = None
        self.fio_var.set("")
        self.tel_var.set("")
        self.adr_var.set("")
        self.tree.selection_remove(self.tree.selection())

    def add(self):
        conn = db_connect()
        cur = conn.cursor()
        cur.execute(
            "INSERT INTO –ö–ª–∏–µ–Ω—Ç (–§–ò–û, –¢–µ–ª–µ—Ñ–æ–Ω, –ê–¥—Ä–µ—Å) VALUES (?, ?, ?)",
            (self.fio_var.get(), self.tel_var.get(), self.adr_var.get())
        )
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()

    def update(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞")
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute(
            "UPDATE –ö–ª–∏–µ–Ω—Ç SET –§–ò–û=?, –¢–µ–ª–µ—Ñ–æ–Ω=?, –ê–¥—Ä–µ—Å=? WHERE ID_–ö–ª–∏–µ–Ω—Ç–∞=?",
            (self.fio_var.get(), self.tel_var.get(), self.adr_var.get(), self.selected_id)
        )
        conn.commit()
        conn.close()
        self.load_data()

    def delete(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞")
            return
        if not messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ", "–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞?"):
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("DELETE FROM –ö–ª–∏–µ–Ω—Ç WHERE ID_–ö–ª–∏–µ–Ω—Ç–∞=?", (self.selected_id,))
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()


class BranchPage(BasePage):
    def __init__(self, parent):
        super().__init__(parent)
        self.selected_id = None
        self.build_ui()
        self.load_data()

    def build_ui(self):
        cols = ("id", "name", "addr")
        heads = [
            ("id", "ID", 60),
            ("name", "–ù–∞–∑–≤–∞–Ω–∏–µ", 220),
            ("addr", "–ê–¥—Ä–µ—Å", 300),
        ]
        self.tree = self.create_tree(cols, heads)
        self.tree.bind("<<TreeviewSelect>>", self.on_select)

        form = tk.Frame(self, bg="#000")
        form.pack(fill="x", padx=20, pady=5)

        self.id_var = tk.StringVar()
        self.name_var = tk.StringVar()
        self.addr_var = tk.StringVar()

        tk.Label(form, text="ID –æ—Ç–¥–µ–ª–µ–Ω–∏—è", fg="white", bg="#000").grid(row=0, column=0, sticky="w")
        tk.Entry(form, textvariable=self.id_var).grid(row=0, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–ù–∞–∑–≤–∞–Ω–∏–µ", fg="white", bg="#000").grid(row=1, column=0, sticky="w")
        tk.Entry(form, textvariable=self.name_var).grid(row=1, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–ê–¥—Ä–µ—Å", fg="white", bg="#000").grid(row=2, column=0, sticky="w")
        tk.Entry(form, textvariable=self.addr_var).grid(row=2, column=1, sticky="ew", padx=5, pady=2)

        form.columnconfigure(1, weight=1)

        btns = tk.Frame(self, bg="#000")
        btns.pack(fill="x", padx=20, pady=5)

        tk.Button(btns, text="–î–æ–±–∞–≤–∏—Ç—å", command=self.add).pack(side="left", padx=5)
        tk.Button(btns, text="–û–±–Ω–æ–≤–∏—Ç—å", command=self.update).pack(side="left", padx=5)
        tk.Button(btns, text="–£–¥–∞–ª–∏—Ç—å", command=self.delete).pack(side="left", padx=5)
        tk.Button(btns, text="–û—á–∏—Å—Ç–∏—Ç—å", command=self.clear_form).pack(side="left", padx=5)

    def load_data(self):
        for r in self.tree.get_children():
            self.tree.delete(r)
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("SELECT ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è, –ù–∞–∑–≤–∞–Ω–∏–µ, –ê–¥—Ä–µ—Å FROM –û—Ç–¥–µ–ª–µ–Ω–∏–µ")
        for row in cur.fetchall():
            self.tree.insert("", "end", values=row)
        conn.close()

    def on_select(self, _):
        sel = self.tree.selection()
        if not sel:
            return
        vals = self.tree.item(sel[0], "values")
        self.selected_id = int(vals[0])
        self.id_var.set(vals[0])
        self.name_var.set(vals[1])
        self.addr_var.set(vals[2])

    def clear_form(self):
        self.selected_id = None
        self.id_var.set("")
        self.name_var.set("")
        self.addr_var.set("")
        self.tree.selection_remove(self.tree.selection())

    def add(self):
        if not self.id_var.get().isdigit():
            messagebox.showerror("–û—à–∏–±–∫–∞", "ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º")
            return
        conn = db_connect()
        cur = conn.cursor()
        try:
            cur.execute(
                "INSERT INTO –û—Ç–¥–µ–ª–µ–Ω–∏–µ (ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è, –ù–∞–∑–≤–∞–Ω–∏–µ, –ê–¥—Ä–µ—Å) VALUES (?, ?, ?)",
                (int(self.id_var.get()), self.name_var.get(), self.addr_var.get())
            )
            conn.commit()
        except sqlite3.IntegrityError:
            messagebox.showerror("–û—à–∏–±–∫–∞", "ID —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        conn.close()
        self.load_data()

    def update(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ")
            return
        if not self.id_var.get().isdigit():
            messagebox.showerror("–û—à–∏–±–∫–∞", "ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º")
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute(
            "UPDATE –û—Ç–¥–µ–ª–µ–Ω–∏–µ SET ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è=?, –ù–∞–∑–≤–∞–Ω–∏–µ=?, –ê–¥—Ä–µ—Å=? WHERE ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è=?",
            (int(self.id_var.get()), self.name_var.get(), self.addr_var.get(), self.selected_id)
        )
        conn.commit()
        conn.close()
        self.load_data()

    def delete(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ")
            return
        if not messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ", "–£–¥–∞–ª–∏—Ç—å –æ—Ç–¥–µ–ª–µ–Ω–∏–µ?"):
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("DELETE FROM –û—Ç–¥–µ–ª–µ–Ω–∏–µ WHERE ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è=?", (self.selected_id,))
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()


class OperatorPage(BasePage):
    def __init__(self, parent):
        super().__init__(parent)
        self.selected_id = None
        self.build_ui()
        self.load_data()

    def build_ui(self):
        cols = ("id", "fio", "pos", "branch")
        heads = [
            ("id", "ID", 60),
            ("fio", "–§–ò–û", 220),
            ("pos", "–î–æ–ª–∂–Ω–æ—Å—Ç—å", 150),
            ("branch", "ID –æ—Ç–¥–µ–ª–µ–Ω–∏—è", 100),
        ]
        self.tree = self.create_tree(cols, heads)
        self.tree.bind("<<TreeviewSelect>>", self.on_select)

        form = tk.Frame(self, bg="#000")
        form.pack(fill="x", padx=20, pady=5)

        self.fio_var = tk.StringVar()
        self.pos_var = tk.StringVar()
        self.branch_var = tk.StringVar()

        tk.Label(form, text="–§–ò–û", fg="white", bg="#000").grid(row=0, column=0, sticky="w")
        tk.Entry(form, textvariable=self.fio_var).grid(row=0, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–î–æ–ª–∂–Ω–æ—Å—Ç—å", fg="white", bg="#000").grid(row=1, column=0, sticky="w")
        tk.Entry(form, textvariable=self.pos_var).grid(row=1, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="ID –æ—Ç–¥–µ–ª–µ–Ω–∏—è", fg="white", bg="#000").grid(row=2, column=0, sticky="w")
        self.branch_cb = ttk.Combobox(form, textvariable=self.branch_var,
                                      values=get_column_values("–û—Ç–¥–µ–ª–µ–Ω–∏–µ", "ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è"),
                                      state="readonly")
        self.branch_cb.grid(row=2, column=1, sticky="ew", padx=5, pady=2)

        form.columnconfigure(1, weight=1)

        btns = tk.Frame(self, bg="#000")
        btns.pack(fill="x", padx=20, pady=5)

        tk.Button(btns, text="–î–æ–±–∞–≤–∏—Ç—å", command=self.add).pack(side="left", padx=5)
        tk.Button(btns, text="–û–±–Ω–æ–≤–∏—Ç—å", command=self.update).pack(side="left", padx=5)
        tk.Button(btns, text="–£–¥–∞–ª–∏—Ç—å", command=self.delete).pack(side="left", padx=5)
        tk.Button(btns, text="–û—á–∏—Å—Ç–∏—Ç—å", command=self.clear_form).pack(side="left", padx=5)

    def reload_branch_ids(self):
        self.branch_cb["values"] = get_column_values("–û—Ç–¥–µ–ª–µ–Ω–∏–µ", "ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è")

    def load_data(self):
        self.reload_branch_ids()
        for r in self.tree.get_children():
            self.tree.delete(r)
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("SELECT ID_–û–ø–µ—Ä–∞—Ç–æ—Ä–∞, –§–ò–û, –î–æ–ª–∂–Ω–æ—Å—Ç—å, ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è FROM –û–ø–µ—Ä–∞—Ç–æ—Ä")
        for row in cur.fetchall():
            self.tree.insert("", "end", values=row)
        conn.close()

    def on_select(self, _):
        sel = self.tree.selection()
        if not sel:
            return
        vals = self.tree.item(sel[0], "values")
        self.selected_id = int(vals[0])
        self.fio_var.set(vals[1])
        self.pos_var.set(vals[2])
        self.branch_var.set(str(vals[3]))

    def clear_form(self):
        self.selected_id = None
        self.fio_var.set("")
        self.pos_var.set("")
        self.branch_var.set("")
        self.tree.selection_remove(self.tree.selection())

    def add(self):
        if not self.branch_var.get():
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ ID –æ—Ç–¥–µ–ª–µ–Ω–∏—è")
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute(
            "INSERT INTO –û–ø–µ—Ä–∞—Ç–æ—Ä (–§–ò–û, –î–æ–ª–∂–Ω–æ—Å—Ç—å, ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è) VALUES (?, ?, ?)",
            (self.fio_var.get(), self.pos_var.get(), int(self.branch_var.get()))
        )
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()

    def update(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞")
            return
        if not self.branch_var.get():
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ ID –æ—Ç–¥–µ–ª–µ–Ω–∏—è")
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute(
            "UPDATE –û–ø–µ—Ä–∞—Ç–æ—Ä SET –§–ò–û=?, –î–æ–ª–∂–Ω–æ—Å—Ç—å=?, ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è=? WHERE ID_–û–ø–µ—Ä–∞—Ç–æ—Ä–∞=?",
            (self.fio_var.get(), self.pos_var.get(), int(self.branch_var.get()), self.selected_id)
        )
        conn.commit()
        conn.close()
        self.load_data()

    def delete(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞")
            return
        if not messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ", "–£–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞?"):
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("DELETE FROM –û–ø–µ—Ä–∞—Ç–æ—Ä WHERE ID_–û–ø–µ—Ä–∞—Ç–æ—Ä–∞=?", (self.selected_id,))
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()


class ParcelPage(BasePage):
    DATE_RE = re.compile(r"\d{2}\.\d{2}\.\d{4}")

    def __init__(self, parent):
        super().__init__(parent)
        self.selected_id = None
        self.build_ui()
        self.load_data()

    def build_ui(self):
        cols = ("id", "cid", "oid", "bid", "typ", "w", "d", "st")
        heads = [
            ("id", "ID", 50),
            ("cid", "–ö–ª–∏–µ–Ω—Ç", 70),
            ("oid", "–û–ø–µ—Ä–∞—Ç–æ—Ä", 70),
            ("bid", "–û—Ç–¥–µ–ª–µ–Ω–∏–µ", 80),
            ("typ", "–¢–∏–ø", 80),
            ("w", "–í–µ—Å", 60),
            ("d", "–î–∞—Ç–∞ –ø—Ä–∏—ë–º–∞", 100),
            ("st", "–°—Ç–∞—Ç—É—Å", 100),
        ]
        self.tree = self.create_tree(cols, heads)
        self.tree.bind("<<TreeviewSelect>>", self.on_select)

        form = tk.Frame(self, bg="#000")
        form.pack(fill="x", padx=20, pady=5)

        self.cid_var = tk.StringVar()
        self.oid_var = tk.StringVar()
        self.bid_var = tk.StringVar()
        self.typ_var = tk.StringVar()
        self.w_var = tk.StringVar()
        self.d_var = tk.StringVar()
        self.st_var = tk.StringVar()

        tk.Label(form, text="–ö–ª–∏–µ–Ω—Ç", fg="white", bg="#000").grid(row=0, column=0, sticky="w")
        self.cid_cb = ttk.Combobox(form, textvariable=self.cid_var,
                                   values=get_column_values("–ö–ª–∏–µ–Ω—Ç", "ID_–ö–ª–∏–µ–Ω—Ç–∞"),
                                   state="readonly")
        self.cid_cb.grid(row=0, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–û–ø–µ—Ä–∞—Ç–æ—Ä", fg="white", bg="#000").grid(row=0, column=2, sticky="w")
        self.oid_cb = ttk.Combobox(form, textvariable=self.oid_var,
                                   values=get_column_values("–û–ø–µ—Ä–∞—Ç–æ—Ä", "ID_–û–ø–µ—Ä–∞—Ç–æ—Ä–∞"),
                                   state="readonly")
        self.oid_cb.grid(row=0, column=3, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–û—Ç–¥–µ–ª–µ–Ω–∏–µ", fg="white", bg="#000").grid(row=1, column=0, sticky="w")
        self.bid_cb = ttk.Combobox(form, textvariable=self.bid_var,
                                   values=get_column_values("–û—Ç–¥–µ–ª–µ–Ω–∏–µ", "ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è"),
                                   state="readonly")
        self.bid_cb.grid(row=1, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–¢–∏–ø", fg="white", bg="#000").grid(row=1, column=2, sticky="w")
        self.typ_cb = ttk.Combobox(form, textvariable=self.typ_var,
                                   values=PARCEL_TYPES, state="readonly")
        self.typ_cb.grid(row=1, column=3, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–í–µ—Å (–∫–≥)", fg="white", bg="#000").grid(row=2, column=0, sticky="w")
        tk.Entry(form, textvariable=self.w_var).grid(row=2, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–î–∞—Ç–∞ (–¥–¥.–º–º.–≥–≥–≥–≥)", fg="white", bg="#000").grid(row=2, column=2, sticky="w")
        tk.Entry(form, textvariable=self.d_var).grid(row=2, column=3, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–°—Ç–∞—Ç—É—Å", fg="white", bg="#000").grid(row=3, column=0, sticky="w")
        self.st_cb = ttk.Combobox(form, textvariable=self.st_var,
                                  values=PARCEL_STATUS, state="readonly")
        self.st_cb.grid(row=3, column=1, sticky="ew", padx=5, pady=2)

        for c in (1, 3):
            form.columnconfigure(c, weight=1)

        btns = tk.Frame(self, bg="#000")
        btns.pack(fill="x", padx=20, pady=5)

        tk.Button(btns, text="–î–æ–±–∞–≤–∏—Ç—å", command=self.add).pack(side="left", padx=5)
        tk.Button(btns, text="–û–±–Ω–æ–≤–∏—Ç—å", command=self.update).pack(side="left", padx=5)
        tk.Button(btns, text="–£–¥–∞–ª–∏—Ç—å", command=self.delete).pack(side="left", padx=5)
        tk.Button(btns, text="–û—á–∏—Å—Ç–∏—Ç—å", command=self.clear_form).pack(side="left", padx=5)

    def reload_refs(self):
        self.cid_cb["values"] = get_column_values("–ö–ª–∏–µ–Ω—Ç", "ID_–ö–ª–∏–µ–Ω—Ç–∞")
        self.oid_cb["values"] = get_column_values("–û–ø–µ—Ä–∞—Ç–æ—Ä", "ID_–û–ø–µ—Ä–∞—Ç–æ—Ä–∞")
        self.bid_cb["values"] = get_column_values("–û—Ç–¥–µ–ª–µ–Ω–∏–µ", "ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è")

    def load_data(self):
        self.reload_refs()
        for r in self.tree.get_children():
            self.tree.delete(r)
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("""
            SELECT ID_–û—Ç–ø—Ä, ID_–ö–ª–∏–µ–Ω—Ç–∞, ID_–û–ø–µ—Ä–∞—Ç–æ—Ä–∞, ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è,
                   –¢–∏–ø, –í–µ—Å, –î–∞—Ç–∞_–ø—Ä–∏–µ–º–∞, –°—Ç–∞—Ç—É—Å
            FROM –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        """)
        for row in cur.fetchall():
            self.tree.insert("", "end", values=row)
        conn.close()

    def on_select(self, _):
        sel = self.tree.selection()
        if not sel:
            return
        vals = self.tree.item(sel[0], "values")
        self.selected_id = int(vals[0])
        self.cid_var.set(str(vals[1]))
        self.oid_var.set(str(vals[2]))
        self.bid_var.set(str(vals[3]))
        self.typ_var.set(vals[4])
        self.w_var.set(str(vals[5]))
        self.d_var.set(vals[6])
        self.st_var.set(vals[7])

    def clear_form(self):
        self.selected_id = None
        self.cid_var.set("")
        self.oid_var.set("")
        self.bid_var.set("")
        self.typ_var.set("")
        self.w_var.set("")
        self.d_var.set("")
        self.st_var.set("")
        self.tree.selection_remove(self.tree.selection())

    def _validate(self):
        if not (self.cid_var.get() and self.oid_var.get() and self.bid_var.get()):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞, –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∏ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ")
            return False
        try:
            float(self.w_var.get())
        except ValueError:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í–µ—Å ‚Äî —á–∏—Å–ª–æ")
            return False
        if not self.DATE_RE.fullmatch(self.d_var.get()):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–¥.–º–º.–≥–≥–≥–≥")
            return False
        return True

    def add(self):
        if not self._validate():
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("""
            INSERT INTO –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            (ID_–ö–ª–∏–µ–Ω—Ç–∞, ID_–û–ø–µ—Ä–∞—Ç–æ—Ä–∞, ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è, –¢–∏–ø, –í–µ—Å, –î–∞—Ç–∞_–ø—Ä–∏–µ–º–∞, –°—Ç–∞—Ç—É—Å)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        """, (int(self.cid_var.get()), int(self.oid_var.get()), int(self.bid_var.get()),
              self.typ_var.get(), float(self.w_var.get()),
              self.d_var.get(), self.st_var.get()))
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()

    def update(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ")
            return
        if not self._validate():
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("""
            UPDATE –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            SET ID_–ö–ª–∏–µ–Ω—Ç–∞=?, ID_–û–ø–µ—Ä–∞—Ç–æ—Ä–∞=?, ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è=?,
                –¢–∏–ø=?, –í–µ—Å=?, –î–∞—Ç–∞_–ø—Ä–∏–µ–º–∞=?, –°—Ç–∞—Ç—É—Å=?
            WHERE ID_–û—Ç–ø—Ä=?
        """, (int(self.cid_var.get()), int(self.oid_var.get()), int(self.bid_var.get()),
              self.typ_var.get(), float(self.w_var.get()),
              self.d_var.get(), self.st_var.get(), self.selected_id))
        conn.commit()
        conn.close()
        self.load_data()

    def delete(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ")
            return
        if not messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ", "–£–¥–∞–ª–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ?"):
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("DELETE FROM –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WHERE ID_–û—Ç–ø—Ä=?", (self.selected_id,))
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()


class PaymentPage(BasePage):
    DATE_RE = re.compile(r"\d{2}\.\d{2}\.\d{4}")

    def __init__(self, parent):
        super().__init__(parent)
        self.selected_id = None
        self.build_ui()
        self.load_data()

    def build_ui(self):
        cols = ("id", "pid", "sum", "date", "meth")
        heads = [
            ("id", "ID", 50),
            ("pid", "ID –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è", 110),
            ("sum", "–°—É–º–º–∞", 80),
            ("date", "–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã", 100),
            ("meth", "–°–ø–æ—Å–æ–±", 120),
        ]
        self.tree = self.create_tree(cols, heads)
        self.tree.bind("<<TreeviewSelect>>", self.on_select)

        form = tk.Frame(self, bg="#000")
        form.pack(fill="x", padx=20, pady=5)

        self.parcel_var = tk.StringVar()
        self.sum_var = tk.StringVar()
        self.date_var = tk.StringVar()
        self.meth_var = tk.StringVar()

        tk.Label(form, text="–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", fg="white", bg="#000").grid(row=0, column=0, sticky="w")
        self.parcel_cb = ttk.Combobox(form, textvariable=self.parcel_var,
                                      values=get_column_values("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", "ID_–û—Ç–ø—Ä"),
                                      state="readonly")
        self.parcel_cb.grid(row=0, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–°—É–º–º–∞", fg="white", bg="#000").grid(row=0, column=2, sticky="w")
        tk.Entry(form, textvariable=self.sum_var).grid(row=0, column=3, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–î–∞—Ç–∞ (–¥–¥.–º–º.–≥–≥–≥–≥)", fg="white", bg="#000").grid(row=1, column=0, sticky="w")
        tk.Entry(form, textvariable=self.date_var).grid(row=1, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–°–ø–æ—Å–æ–±", fg="white", bg="#000").grid(row=1, column=2, sticky="w")
        self.meth_cb = ttk.Combobox(form, textvariable=self.meth_var,
                                    values=PAYMENT_METHODS, state="readonly")
        self.meth_cb.grid(row=1, column=3, sticky="ew", padx=5, pady=2)

        for c in (1, 3):
            form.columnconfigure(c, weight=1)

        btns = tk.Frame(self, bg="#000")
        btns.pack(fill="x", padx=20, pady=5)

        tk.Button(btns, text="–î–æ–±–∞–≤–∏—Ç—å", command=self.add).pack(side="left", padx=5)
        tk.Button(btns, text="–û–±–Ω–æ–≤–∏—Ç—å", command=self.update).pack(side="left", padx=5)
        tk.Button(btns, text="–£–¥–∞–ª–∏—Ç—å", command=self.delete).pack(side="left", padx=5)
        tk.Button(btns, text="–û—á–∏—Å—Ç–∏—Ç—å", command=self.clear_form).pack(side="left", padx=5)

    def reload_refs(self):
        self.parcel_cb["values"] = get_column_values("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", "ID_–û—Ç–ø—Ä")

    def load_data(self):
        self.reload_refs()
        for r in self.tree.get_children():
            self.tree.delete(r)
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("""
            SELECT ID_–ü–ª–∞—Ç–µ–∂–∞, ID_–û—Ç–ø—Ä, –°—É–º–º–∞, –î–∞—Ç–∞_–æ–ø–ª–∞—Ç—ã, –°–ø–æ—Å–æ–±_–æ–ø–ª–∞—Ç—ã
            FROM –ü–ª–∞—Ç–µ–∂
        """)
        for row in cur.fetchall():
            self.tree.insert("", "end", values=row)
        conn.close()

    def on_select(self, _):
        sel = self.tree.selection()
        if not sel:
            return
        vals = self.tree.item(sel[0], "values")
        self.selected_id = int(vals[0])
        self.parcel_var.set(str(vals[1]))
        self.sum_var.set(str(vals[2]))
        self.date_var.set(vals[3])
        self.meth_var.set(vals[4])

    def clear_form(self):
        self.selected_id = None
        self.parcel_var.set("")
        self.sum_var.set("")
        self.date_var.set("")
        self.meth_var.set("")
        self.tree.selection_remove(self.tree.selection())

    def _validate(self):
        if not self.parcel_var.get():
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ")
            return False
        try:
            float(self.sum_var.get())
        except ValueError:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–°—É–º–º–∞ ‚Äî —á–∏—Å–ª–æ")
            return False
        if not self.DATE_RE.fullmatch(self.date_var.get()):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–¥.–º–º.–≥–≥–≥–≥")
            return False
        return True

    def add(self):
        if not self._validate():
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("""
            INSERT INTO –ü–ª–∞—Ç–µ–∂ (ID_–û—Ç–ø—Ä, –°—É–º–º–∞, –î–∞—Ç–∞_–æ–ø–ª–∞—Ç—ã, –°–ø–æ—Å–æ–±_–æ–ø–ª–∞—Ç—ã)
            VALUES (?, ?, ?, ?)
        """, (int(self.parcel_var.get()), float(self.sum_var.get()),
              self.date_var.get(), self.meth_var.get()))
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()

    def update(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç–µ–∂")
            return
        if not self._validate():
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("""
            UPDATE –ü–ª–∞—Ç–µ–∂
            SET ID_–û—Ç–ø—Ä=?, –°—É–º–º–∞=?, –î–∞—Ç–∞_–æ–ø–ª–∞—Ç—ã=?, –°–ø–æ—Å–æ–±_–æ–ø–ª–∞—Ç—ã=?
            WHERE ID_–ü–ª–∞—Ç–µ–∂–∞=?
        """, (int(self.parcel_var.get()), float(self.sum_var.get()),
              self.date_var.get(), self.meth_var.get(), self.selected_id))
        conn.commit()
        conn.close()
        self.load_data()

    def delete(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç–µ–∂")
            return
        if not messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ", "–£–¥–∞–ª–∏—Ç—å –ø–ª–∞—Ç–µ–∂?"):
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("DELETE FROM –ü–ª–∞—Ç–µ–∂ WHERE ID_–ü–ª–∞—Ç–µ–∂–∞=?", (self.selected_id,))
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()


class RoutePage(BasePage):
    DATE_RE = re.compile(r"\d{2}\.\d{2}\.\d{4}")

    def __init__(self, parent):
        super().__init__(parent)
        self.selected_id = None
        self.build_ui()
        self.load_data()

    def build_ui(self):
        cols = ("id", "pid", "from", "to", "d1", "d2")
        heads = [
            ("id", "ID", 50),
            ("pid", "–û—Ç–ø—Ä.", 60),
            ("from", "–û—Ç–ø—Ä–∞–≤–∫–∞", 80),
            ("to", "–ü—Ä–∏–±—ã—Ç–∏–µ", 80),
            ("d1", "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏", 110),
            ("d2", "–î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è", 110),
        ]
        self.tree = self.create_tree(cols, heads)
        self.tree.bind("<<TreeviewSelect>>", self.on_select)

        form = tk.Frame(self, bg="#000")
        form.pack(fill="x", padx=20, pady=5)

        self.parcel_var = tk.StringVar()
        self.from_var = tk.StringVar()
        self.to_var = tk.StringVar()
        self.d1_var = tk.StringVar()
        self.d2_var = tk.StringVar()

        tk.Label(form, text="–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", fg="white", bg="#000").grid(row=0, column=0, sticky="w")
        self.parcel_cb = ttk.Combobox(form, textvariable=self.parcel_var,
                                      values=get_column_values("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", "ID_–û—Ç–ø—Ä"),
                                      state="readonly")
        self.parcel_cb.grid(row=0, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–û—Ç–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏", fg="white", bg="#000").grid(row=1, column=0, sticky="w")
        self.from_cb = ttk.Combobox(form, textvariable=self.from_var,
                                    values=get_column_values("–û—Ç–¥–µ–ª–µ–Ω–∏–µ", "ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è"),
                                    state="readonly")
        self.from_cb.grid(row=1, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–û—Ç–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–±—ã—Ç–∏—è", fg="white", bg="#000").grid(row=1, column=2, sticky="w")
        self.to_cb = ttk.Combobox(form, textvariable=self.to_var,
                                  values=get_column_values("–û—Ç–¥–µ–ª–µ–Ω–∏–µ", "ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è"),
                                  state="readonly")
        self.to_cb.grid(row=1, column=3, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–¥–¥.–º–º.–≥–≥–≥–≥)", fg="white", bg="#000").grid(row=2, column=0, sticky="w")
        tk.Entry(form, textvariable=self.d1_var).grid(row=2, column=1, sticky="ew", padx=5, pady=2)

        tk.Label(form, text="–î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è (–¥–¥.–º–º.–≥–≥–≥–≥)", fg="white", bg="#000").grid(row=2, column=2, sticky="w")
        tk.Entry(form, textvariable=self.d2_var).grid(row=2, column=3, sticky="ew", padx=5, pady=2)

        for c in (1, 3):
            form.columnconfigure(c, weight=1)

        btns = tk.Frame(self, bg="#000")
        btns.pack(fill="x", padx=20, pady=5)

        tk.Button(btns, text="–î–æ–±–∞–≤–∏—Ç—å", command=self.add).pack(side="left", padx=5)
        tk.Button(btns, text="–û–±–Ω–æ–≤–∏—Ç—å", command=self.update).pack(side="left", padx=5)
        tk.Button(btns, text="–£–¥–∞–ª–∏—Ç—å", command=self.delete).pack(side="left", padx=5)
        tk.Button(btns, text="–û—á–∏—Å—Ç–∏—Ç—å", command=self.clear_form).pack(side="left", padx=5)

    def reload_refs(self):
        self.parcel_cb["values"] = get_column_values("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", "ID_–û—Ç–ø—Ä")
        ids = get_column_values("–û—Ç–¥–µ–ª–µ–Ω–∏–µ", "ID_–û—Ç–¥–µ–ª–µ–Ω–∏—è")
        self.from_cb["values"] = ids
        self.to_cb["values"] = ids

    def load_data(self):
        self.reload_refs()
        for r in self.tree.get_children():
            self.tree.delete(r)
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("""
            SELECT ID_–ú–∞—Ä—à—Ä—É—Ç–∞, ID_–û—Ç–ø—Ä, –û—Ç–¥–µ–ª–µ–Ω–∏–µ_–æ—Ç–ø—Ä–∞–≤–∫–∏,
                   –û—Ç–¥–µ–ª–µ–Ω–∏–µ_–ø—Ä–∏–±—ã—Ç–∏—è, –î–∞—Ç–∞_–æ—Ç–ø—Ä–∞–≤–∫–∏, –î–∞—Ç–∞_–ø—Ä–∏–±—ã—Ç–∏—è
            FROM –ú–∞—Ä—à—Ä—É—Ç
        """)
        for row in cur.fetchall():
            self.tree.insert("", "end", values=row)
        conn.close()

    def on_select(self, _):
        sel = self.tree.selection()
        if not sel:
            return
        vals = self.tree.item(sel[0], "values")
        self.selected_id = int(vals[0])
        self.parcel_var.set(str(vals[1]))
        self.from_var.set(str(vals[2]))
        self.to_var.set(str(vals[3]))
        self.d1_var.set(vals[4] or "")
        self.d2_var.set(vals[5] or "")

    def clear_form(self):
        self.selected_id = None
        self.parcel_var.set("")
        self.from_var.set("")
        self.to_var.set("")
        self.d1_var.set("")
        self.d2_var.set("")
        self.tree.selection_remove(self.tree.selection())

    def _validate(self):
        if not (self.parcel_var.get() and self.from_var.get() and self.to_var.get()):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç–¥–µ–ª–µ–Ω–∏—è")
            return False
        if self.d1_var.get() and not self.DATE_RE.fullmatch(self.d1_var.get()):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–¥.–º–º.–≥–≥–≥–≥")
            return False
        if self.d2_var.get() and not self.DATE_RE.fullmatch(self.d2_var.get()):
            messagebox.showerror("–û—à–∏–±–∫–∞", "–î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–¥.–º–º.–≥–≥–≥–≥")
            return False
        return True

    def add(self):
        if not self._validate():
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("""
            INSERT INTO –ú–∞—Ä—à—Ä—É—Ç
            (ID_–û—Ç–ø—Ä, –û—Ç–¥–µ–ª–µ–Ω–∏–µ_–æ—Ç–ø—Ä–∞–≤–∫–∏, –û—Ç–¥–µ–ª–µ–Ω–∏–µ_–ø—Ä–∏–±—ã—Ç–∏—è, –î–∞—Ç–∞_–æ—Ç–ø—Ä–∞–≤–∫–∏, –î–∞—Ç–∞_–ø—Ä–∏–±—ã—Ç–∏—è)
            VALUES (?, ?, ?, ?, ?)
        """, (int(self.parcel_var.get()), int(self.from_var.get()),
              int(self.to_var.get()), self.d1_var.get(), self.d2_var.get()))
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()

    def update(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç")
            return
        if not self._validate():
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("""
            UPDATE –ú–∞—Ä—à—Ä—É—Ç
            SET ID_–û—Ç–ø—Ä=?, –û—Ç–¥–µ–ª–µ–Ω–∏–µ_–æ—Ç–ø—Ä–∞–≤–∫–∏=?, –û—Ç–¥–µ–ª–µ–Ω–∏–µ_–ø—Ä–∏–±—ã—Ç–∏—è=?,
                –î–∞—Ç–∞_–æ—Ç–ø—Ä–∞–≤–∫–∏=?, –î–∞—Ç–∞_–ø—Ä–∏–±—ã—Ç–∏—è=?
            WHERE ID_–ú–∞—Ä—à—Ä—É—Ç–∞=?
        """, (int(self.parcel_var.get()), int(self.from_var.get()),
              int(self.to_var.get()), self.d1_var.get(), self.d2_var.get(), self.selected_id))
        conn.commit()
        conn.close()
        self.load_data()

    def delete(self):
        if self.selected_id is None:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç")
            return
        if not messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ", "–£–¥–∞–ª–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç?"):
            return
        conn = db_connect()
        cur = conn.cursor()
        cur.execute("DELETE FROM –ú–∞—Ä—à—Ä—É—Ç WHERE ID_–ú–∞—Ä—à—Ä—É—Ç–∞=?", (self.selected_id,))
        conn.commit()
        conn.close()
        self.clear_form()
        self.load_data()


class PostOfficeApp(tk.Tk):
    def __init__(self):
        super().__init__()
        self.title("–ê–ò–° –ü–æ—á—Ç–∞")
        self.geometry("1200x750")
        self.configure(bg="#000")

        self.sidebar = tk.Frame(self, bg="#111", width=220)
        self.sidebar.pack(side="left", fill="y")

        tk.Label(self.sidebar, text="üìÆ –ê–ò–° –ü–æ—á—Ç–∞",
                 fg="white", bg="#111",
                 font=("San Francisco", 22, "bold")).pack(pady=25)

        self.container = tk.Frame(self, bg="#000")
        self.container.pack(side="right", expand=True, fill="both")

        self.pages = {}
        self.current_page = None

        self.add_menu("–ö–ª–∏–µ–Ω—Ç—ã", lambda: self.show_page("clients"))
        self.add_menu("–û—Ç–¥–µ–ª–µ–Ω–∏—è", lambda: self.show_page("branches"))
        self.add_menu("–û–ø–µ—Ä–∞—Ç–æ—Ä—ã", lambda: self.show_page("operators"))
        self.add_menu("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è", lambda: self.show_page("parcels"))
        self.add_menu("–ü–ª–∞—Ç–µ–∂–∏", lambda: self.show_page("payments"))
        self.add_menu("–ú–∞—Ä—à—Ä—É—Ç—ã", lambda: self.show_page("routes"))

        self.create_pages()
        self.show_page("clients")

    def add_menu(self, text, cmd):
        l = tk.Label(self.sidebar, text=text,
                     fg="white", bg="#111",
                     font=("San Francisco", 16), pady=10)
        l.pack(fill="x", padx=15, pady=3)
        l.bind("<Button-1>", lambda e: cmd())
        l.bind("<Enter>", lambda e: l.config(bg="#222"))
        l.bind("<Leave>", lambda e: l.config(bg="#111"))

    def create_pages(self):
        self.pages["clients"] = ClientPage(self.container)
        self.pages["branches"] = BranchPage(self.container)
        self.pages["operators"] = OperatorPage(self.container)
        self.pages["parcels"] = ParcelPage(self.container)
        self.pages["payments"] = PaymentPage(self.container)
        self.pages["routes"] = RoutePage(self.container)

    def show_page(self, name):
        if self.current_page:
            self.current_page.pack_forget()
        page = self.pages[name]
        page.pack(fill="both", expand=True)
        self.current_page = page


if __name__ == "__main__":
    PostOfficeApp().mainloop()
